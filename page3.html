<html lang="en">
<meta charset="utf-8">
<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<title>Protein Sources in Plant-Based Diets</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}
</style>

<body>  
 <div id="bubble_chart" style="margin-top:75px">
        <h1 ><b>A Look at Protein in Plant-Based Diets</b></h1>
        <h2 ><b>High Protein Plant-Based Foods</b></h2>
    <p>There are many plant based foods that are actually protein rich, many of which are beans/lentils or nuts/seeds. There are also plant-based protein powders, meat and cheese replacements available at grocery stores in most major cities. The options for plant-based protein are plentiful and tasty! Try hovering over one of the circles to see the nutrition facts of some of the foods with highest protein content.</p>

<script>
const margin = {top: 30, right: 300, bottom: 150, left: 100},
    width = 900 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

const svg3 = d3.select("#bubble_chart")
.append("svg")
  .attr("width", 1500)
  .attr("height", 500)

d3.csv("https://raw.githubusercontent.com/shirleyli2015/narrative_viz.github.io/master/data/MyFoodData_Nutrition_Facts_SpreadSheet_3.csv").then( function(data) {
data = data.filter(function(d){ return d['Protein (g)'] })

const color = d3.scaleOrdinal()
  .domain(["Beans and Lentils", "Vegetables", "Fruits","Grains and Pasta", "Nuts and Seeds"])
  .range(["#aaaa55", "#69b3a2", "#ff8080", "#ffd24d", "#b33c00"]);

const size = d3.scaleLinear()
  .domain([0, 150])
  .range([1,55])  

const Tooltip = d3.select("#bubble_chart")
  .append("div")
  .style("opacity", 0)
  .attr("class", "tooltip")
  .style("background-color", "white")
  .style("border", "solid")
  .style("border-width", "2px")
  .style("border-radius", "5px")
  .style("padding", "5px")

const mouseover = function(event, d) {
  Tooltip
    .style("opacity", 1)
}
const mousemove = function(event, d) {
  Tooltip
    .html('<u>' + d.Name + '</u>' + "<br>" + d.Calories + " Calories" + "<br>" + d['Protein (g)'] +' (g) Protein')
    .style("right", (event.x/2+20) + "px")
    .style("top", (event.y/2-30) + "px")
}
var mouseleave = function(event, d) {
  Tooltip
    .style("opacity", 0)
}

var node = svg3.append("g")
  .attr("transform",
          "translate(" + margin.left + "," + 100 + ")")
  .selectAll("circle")
  .data(data)
  .join("circle")
    .attr("class", "node")
    .attr("r", d => size(d['Protein (g)']))
    .attr("cx", width)
    .attr("cy", height)
    .style("fill", d => color(d.Food_Group))
    .style("fill-opacity", 0.6)
    .attr("stroke", "black")
    .style("stroke-width", 1)
    .on("mouseover", mouseover) 
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)
    .call(d3.drag() 
         .on("start", dragstarted)
         .on("drag", dragged)
         .on("end", dragended));

const simulation = d3.forceSimulation()
    .force("center", d3.forceCenter().x(width/2).y(height/2))
    .force("charge", d3.forceManyBody().strength(.1)) 
    .force("collide", d3.forceCollide().strength(.2).radius(function(d){ return (size(d['Protein (g)'])+3) }).iterations(1)) 

simulation
    .nodes(data)
    .on("tick", function(d){
      node
          .attr("cx", d => d.x)
          .attr("cy", d => d.y)
    });

function dragstarted(event, d) {
  if (!event.active) simulation.alphaTarget(.03).restart();
  d.fx = d.x;
  d.fy = d.y;
}
function dragged(event, d) {
  d.fx = event.x;
  d.fy = event.y;
}
function dragended(event, d) {
  if (!event.active) simulation.alphaTarget(.03);
  d.fx = null;
  d.fy = null;
}

var plants = ["Beans and Lentils", "Vegetables", "Fruits","Grains and Pasta", "Nuts and Seeds"]
var color2 = d3.scaleOrdinal()
  .domain(plants)
  .range(["#aaaa55", "#69b3a2", "#ff8080", "#ffd24d", "#b33c00"]);

var size2 = 20
svg3.selectAll("mydots")
  .data(plants)
  .enter()
  .append("rect")
    .attr("x", 560)
    .attr("y", function(d,i){ return i*(size2+5)}) 
    .attr("width", size2)
    .attr("height", size2)
    .style("fill", function(d){ return color2(d)})

svg3.selectAll("mylabels")
  .data(plants)
  .enter()
  .append("text")
    .attr("x", 560 + size2*1.2)
    .attr("y", function(d,i){ return i*(size2+5) + (size2/2)}) 
    .style("fill", function(d){ return color2(d)})
    .text(function(d){ return d})
    .attr("text-anchor", "left")
    .style("alignment-baseline", "middle")
})

</script>
  </div>
</body>
<button type="button" onclick="location.href='https://shirleyli2015.github.io/narrative_viz.github.io/page2.html';">Previous</button>
</html>